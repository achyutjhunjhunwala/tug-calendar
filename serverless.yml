service: tug-calendar

plugins:
  - serverless-offline
  - serverless-prune-plugin

frameworkVersion: ~4.17.0

build:
  esbuild:
    bundle: true
    minify: true
    sourcemap: false
    exclude:
      - googleapis
      - google-auth-library
    target: node22
    platform: node

provider:
  name: aws
  runtime: nodejs22.x
  stage: ${opt:stage, 'dev'}
  region: ${opt:region, self:custom.defaultRegion}
  timeout: 30
  memorySize: 256
  environment:
    NODE_ENV: ${self:provider.stage}
    SERVICE_NAME: tug-calendar
    LOG_LEVEL: info
    TUG_NS_API: ${ssm:TUG_NS_API}
    TUG_NS_TOKEN: ${ssm:TUG_NS_TOKEN}
    ELASTIC_CLOUD_ID: ${ssm:ELASTIC_CLOUD_ID, ''}
    ELASTIC_API_KEY: ${ssm:ELASTIC_API_KEY, ''}

custom:
  defaultRegion: eu-central-1
  defaultStage: production
  currentStage: ${opt:stage, self:custom.defaultStage}
  environments:
    dev: 'dev'
    prod: 'prod'
  prune:
    automatic: true
    number: 3

functions:
  daily:
    handler: src/handlers/daily.handler
    events:
      - schedule:
          rate: cron(0 6 * * ? *)
          method: scheduler
          timezone: UTC

  weekly:
    handler: src/handlers/weekly.handler
    events:
      - schedule:
          rate: cron(0 8 * * ? *)
          method: scheduler
          timezone: UTC

  monthly:
    handler: src/handlers/monthly.handler
    events:
      - schedule:
          rate: cron(30 6 * * ? *)
          method: scheduler
          timezone: UTC
